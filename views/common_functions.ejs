<script>

//TODO: 
function commenti(event){
    localStorage.setItem("event_id",event.getAttribute("event_id"));
    location.assign("http://localhost:3000/commenta_evento");
}

function show_filtro_nome(){
    document.getElementById("seleziona_filtro_nome").style.backgroundColor="#dddddd";
    document.getElementById("seleziona_filtro_data").style.backgroundColor="white";
    document.getElementById("filtro_data_row").style.display="none";
    document.getElementById("filtra_per_data").style.display="none";
    document.getElementById("filtro_nome_row").style.display="table-row";
    document.getElementById("filtra_per_nome").style.display="block";
}

function show_filtro_data(){
    document.getElementById("seleziona_filtro_data").style.backgroundColor="#dddddd";
    document.getElementById("seleziona_filtro_nome").style.backgroundColor="white";
    document.getElementById("filtro_nome_row").style.display="none";
    document.getElementById("filtra_per_nome").style.display="none"
    document.getElementById("filtro_data_row").style.display="table-row";
    document.getElementById("filtra_per_data").style.display="block";
}

//TODO: SET EVENT AS FAVOURITE
function highlight(value){
    value.classList.toggle("selected");
}

function set_info_box(evento){
    a=document.getElementById("info_nome");
    b=document.getElementById("info_dove");
    c=document.getElementById("info_quando");
    d=document.getElementById("info_info");

    a.textContent="NOME:\n";
    a.textContent+=evento.getAttribute("name");

    b.textContent="DOVE:\n";
    b.textContent+=evento.getAttribute("place");

    c.textContent="QUANDO:\n";
    c.textContent+=evento.getAttribute("date")+" alle "+evento.getAttribute("time");

    d.textContent="INFO:\n";
    d.textContent+=evento.getAttribute("info");
}

function filtra_nome(){
    if(document.getElementById("filtro_nome").value=="") {
      var DOMContentLoaded_event = document.createEvent("Event");
      DOMContentLoaded_event.initEvent("DOMContentLoaded", true, true);
      window.document.dispatchEvent(DOMContentLoaded_event);
    }
    else{
      var url="http://localhost:3000/api/v1/eventi/"+document.getElementById("filtro_nome").value;
      fetch(url,{
        method:"PUT",
        cache:'no-cache',
        headers:{
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        }
      })
        .then((res) =>{
          return res.json()
        } )
        .then((data) => {
          var e=document.getElementById("puppet");
          var child = e.lastElementChild; 
          if(data.length==0){
            alert("Nessun evento trovato");
            return 0;
          }
          while (child) {
              e.removeChild(child);
              child = e.lastElementChild;
          }
          for(i=0;i<data.length;i++){
            item = document.getElementsByTagName("template")[0].content;
            clone = document.importNode(item,true);
            var body=clone.querySelector("div");
  
            body.setAttribute('style', 'white-space: break-spaces;');
            body.textContent=data[i].title+"\n";
            body.textContent+=data[i].date_event.slice(8,10)+"/"+data[i].date_event.slice(5,7)+"/"+data[i].date_event.slice(0,4)+
            " alle "+data[i].date_event.slice(11,16)+"\n"+data[i].place;
  
            body.setAttribute("name",data[i].title);
            body.setAttribute("place",data[i].place);
            body.setAttribute("date",data[i].date_event.slice(0,10));
            body.setAttribute("time",data[i].date_event.slice(11,16));
            body.setAttribute("info",data[i].info);
            body.setAttribute("id",data[i]._id);
  
            
            document.getElementById("puppet").appendChild(clone);
          }
      })
    }
}
  
function filtra_data(){
    if(document.getElementById("filtro_data").value=="") {
        var DOMContentLoaded_event = document.createEvent("Event");
        DOMContentLoaded_event.initEvent("DOMContentLoaded", true, true);
        window.document.dispatchEvent(DOMContentLoaded_event);
    }
    else{
        var url="http://localhost:3000/api/v1/eventi/data/"+document.getElementById("filtro_data").value;
        fetch(url,{
            method:"PUT",
            cache:'no-cache',
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
            })
            .then((res) =>{
            return res.json()
            } )
            .then((data) => {
            var e=document.getElementById("puppet");
            var child = e.lastElementChild; 
            if(data.length==0){
                alert("Nessun evento trovato");
                return 0;
            }
            while (child) {
                e.removeChild(child);
                child = e.lastElementChild;
            }
            for(i=0;i<data.length;i++){
                item = document.getElementsByTagName("template")[0].content;
                clone = document.importNode(item,true);
                var body=clone.querySelector("div");

                body.setAttribute('style', 'white-space: break-spaces;');
                body.textContent=data[i].title+"\n";
                body.textContent+=data[i].date_event.slice(8,10)+"/"+data[i].date_event.slice(5,7)+"/"+data[i].date_event.slice(0,4)+
                " alle "+data[i].date_event.slice(11,16)+"\n"+data[i].place;

                body.setAttribute("name",data[i].title);
                body.setAttribute("place",data[i].place);
                body.setAttribute("date",data[i].date_event.slice(0,10));
                body.setAttribute("time",data[i].date_event.slice(11,16));
                body.setAttribute("info",data[i].info);
                body.setAttribute("id",data[i]._id);

                
                document.getElementById("puppet").appendChild(clone);
            }
        })
    }
}
//TODO: METTICI ANCHE FUNZIONI DEI FILTRI
</script>